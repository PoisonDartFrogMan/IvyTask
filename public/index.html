<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IvyTask</title>
  <link rel="stylesheet" href="style.css?v=memo_v_mobile_fix_3">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
  <link rel="stylesheet" href="memo-title.css">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#AEC6CF">
  <link rel="apple-touch-icon" href="/icon-192.png">
</head>

<body>

  <div id="startup-screen">
    <div class="startup-card">
      <p class="startup-kicker">モードを選択</p>
      <h1 class="startup-title">Ivy をどちらで使いますか？</h1>
      <p class="startup-subtitle">普段のタスク管理と、チーム人事向けのToDoを分けてスタートできます。</p>
      <div class="startup-actions">
        <button id="start-task-button" class="startup-option primary">
          <span class="option-label">Task</span>
          <span class="option-desc">これまでのタスク管理を開く</span>
        </button>
        <button id="start-todo-button" class="startup-option">
          <span class="option-label">Todo</span>
          <span class="option-desc">人事チーム用ToDo（新機能）</span>
        </button>
        <!-- Memo Button Added -->
        <button id="start-memo-button" class="startup-option">
          <span class="option-label">Memo</span>
          <span class="option-desc">シンプルなメモ帳</span>
        </button>
        <!-- Vault Button Added -->
        <button id="start-vault-button" class="startup-option">
          <span class="option-label">🔐 Vault</span>
          <span class="option-desc">パスワード管理</span>
        </button>
        <!-- DataBase Button Added -->
        <button id="start-database-button" class="startup-option">
          <span class="option-label">👥 DataBase</span>
          <span class="option-desc">職員データ管理</span>
        </button>
      </div>
      <p id="todo-coming-soon" class="startup-note hidden">Todo（人事向け）は準備中です。近日中にお知らせします。</p>
    </div>
  </div>

  <div id="auth-container" style="display: none;">
    <h1>IvyTask</h1>
    <p>アカウントを作成、またはログインしてください</p>
    <input type="email" id="email-input" placeholder="メールアドレス">
    <input type="password" id="password-input" placeholder="パスワード">
    <button id="signup-button">サインアップ</button>
    <button id="login-button">ログイン</button>
    <div class="auth-form-footer">
      <a href="reset-password.html">パスワードをお忘れですか？</a>
    </div>
  </div>

  <main id="app-container" style="display: none;">
    <div id="user-info">
      <span id="user-email"></span>
      <button id="settings-button" class="icon-button" title="設定">⚙️</button>
      <button id="updates-new-button" class="new-badge hidden" title="新しい更新">NEW</button>
    </div>

    <div class="title-bar">
      <div class="title-bar-buttons">
        <button id="task-back-startup-button" class="header-back-btn">スタートに戻る</button>
        <button id="open-add-task-modal-button">タスク追加</button>
        <button id="open-recurring-task-modal-button">繰り返しタスク</button>
        <button id="open-recurring-list-modal-button" type="button">登録済み一覧</button>
      </div>
      <h1>IvyTask</h1>
    </div>

    <div class="main-controls">
      <button id="reload-button">リロード</button>
      <button id="manage-labels-button">ラベルを編集</button>
      <button id="reset-day-button">リセット</button>
      <button id="archive-view-button">アーカイブ</button>
    </div>

    <section>
      <h2>Focalist</h2>
      <ul id="today-tasks"></ul>
      <div id="recurring-tasks-container" class="hidden">
        <h3>繰り返しタスク</h3>
        <ul id="today-recurring-tasks"></ul>
      </div>
    </section>

    <section>
      <h2>タスクストック</h2>
      <ul id="stock-tasks"></ul>
    </section>

    <!-- Happy Hacking sticker -->
    <img id="happy-hacking-sticker" src="/happy-hacking.png" alt="Happy Hacking" />
  </main>

  <div id="todo-container" class="hidden">
    <div class="todo-hero">
      <p class="todo-kicker">人事チーム向け</p>
      <h1 class="todo-title">Team Todo</h1>
      <p class="todo-subtitle">人事・総務のルーチンや依頼をまとめて管理する新しいワークスペースです。</p>
      <div class="todo-actions">
        <button id="todo-back-startup-button" type="button">スタートに戻る</button>

        <button id="todo-settings-button" type="button" class="secondary">設定</button>
      </div>
    </div>
    <section id="candidate-panel" class="todo-section hidden">
      <h2>求職者の進行管理</h2>
      <form id="candidate-form" class="candidate-form">
        <div class="form-row">
          <label for="candidate-name">氏名</label>
          <input id="candidate-name" type="text" placeholder="例: 山田 太郎" required>
        </div>
        <div class="form-row">
          <label for="candidate-start">入社予定日</label>
          <input id="candidate-start" type="date">
        </div>
        <div class="form-row">
          <label for="candidate-dept">配属予定部署</label>
          <input id="candidate-dept" type="text" placeholder="例: プロダクト本部 開発部">
        </div>
        <div class="form-row">
          <label for="candidate-grade">入社後グレード</label>
          <select id="candidate-grade">
            <option value="">選択してください</option>
            <option value="E6">E6</option>
            <option value="E5">E5</option>
            <option value="E4">E4</option>
            <option value="P6">P6</option>
            <option value="P5">P5</option>
            <option value="P4">P4</option>
            <option value="G3">G3</option>
            <option value="G2">G2</option>
            <option value="G1">G1</option>
            <option value="嘱託">嘱託</option>
            <option value="パート">パート</option>
            <option value="派遣">派遣</option>
          </select>
        </div>
        <div class="form-row">
          <label for="candidate-note">メモ</label>
          <input id="candidate-note" type="text" placeholder="アカウント発行、PC準備 など">
        </div>
        <div class="form-row">
          <label for="candidate-type">区分</label>
          <select id="candidate-type">
            <option value="">選択してください</option>
            <option value="新卒">新卒</option>
            <option value="キャリア">キャリア</option>
            <option value="パート">パート</option>
            <option value="派遣">派遣</option>
          </select>
        </div>
        <div class="form-actions" style="display: flex; gap: 10px; align-items: center;">
          <button type="submit">求職者を追加</button>
          <button type="button" id="import-csv-button" class="" style="background-color: #28a745;">CSV読込</button>
          <input type="file" id="import-csv-input" accept=".csv" class="hidden">
        </div>
      </form>
      <div class="candidate-list-wrapper">
        <h3 class="candidate-heading">進行中の求職者</h3>
        <ul id="candidate-list" class="candidate-list empty-state">
          <li class="candidate-empty">まだ登録がありません。</li>
        </ul>
      </div>
    </section>
    <div id="candidate-modal-backdrop" class="hidden">
      <div id="candidate-modal">
        <h2>求職者の詳細</h2>
        <form id="candidate-detail-form" class="candidate-form">
          <div class="form-row">
            <label for="candidate-detail-name">氏名</label>
            <input id="candidate-detail-name" type="text" required>
          </div>
          <div class="form-row">
            <label for="candidate-detail-start">入社予定日</label>
            <input id="candidate-detail-start" type="date">
          </div>
          <div class="form-row">
            <label for="candidate-detail-dept">配属予定部署</label>
            <input id="candidate-detail-dept" type="text">
          </div>
          <div class="form-row">
            <label for="candidate-detail-grade">入社後グレード</label>
            <select id="candidate-detail-grade">
              <option value="">選択してください</option>
              <option value="E6">E6</option>
              <option value="E5">E5</option>
              <option value="E4">E4</option>
              <option value="P6">P6</option>
              <option value="P5">P5</option>
              <option value="P4">P4</option>
              <option value="G3">G3</option>
              <option value="G2">G2</option>
              <option value="G1">G1</option>
              <option value="嘱託">嘱託</option>
              <option value="パート">パート</option>
              <option value="派遣">派遣</option>
            </select>
          </div>
          <div class="form-row">
            <label for="candidate-detail-note">メモ</label>
            <input id="candidate-detail-note" type="text">
          </div>
          <div class="form-row">
            <label for="candidate-detail-type">区分</label>
            <select id="candidate-detail-type">
              <option value="">選択してください</option>
              <option value="新卒">新卒</option>
              <option value="キャリア">キャリア</option>
              <option value="パート">パート</option>
              <option value="派遣">派遣</option>
            </select>
          </div>
          <div class="form-row">
            <label>入社タスク</label>
            <ul id="candidate-detail-tasks" class="candidate-detail-tasks"></ul>
          </div>
          <div class="modal-actions">
            <button type="button" id="migrate-candidate-button"
              style="background-color: #ffd700; color: #333;">DBへ登録</button>
            <button type="button" id="candidate-modal-close">閉じる</button>
            <button type="submit">保存</button>
          </div>
        </form>
      </div>
    </div>
    <div id="onboarding-modal-backdrop" class="hidden">
      <div id="onboarding-modal" class="candidate-modal-small">
        <h3>入社前説明の設定</h3>
        <div class="form-row">
          <label for="onboarding-datetime">日時</label>
          <input id="onboarding-datetime" type="datetime-local">
        </div>
        <label class="checkbox-row">
          <input type="checkbox" id="onboarding-items-checkbox">
          <span>持参物連絡済み</span>
        </label>
        <div class="modal-actions">
          <button type="button" id="onboarding-modal-cancel">キャンセル</button>
          <button type="button" id="onboarding-modal-save">保存</button>
        </div>
      </div>
    </div>
    <div id="candidate-interview-modal-backdrop" class="hidden">
      <div id="candidate-interview-modal" class="candidate-modal-small">
        <h3>面接設定</h3>
        <ul id="interview-modal-list" class="interview-modal-list"></ul>
        <div class="modal-actions">
          <button type="button" id="interview-modal-cancel">キャンセル</button>
          <button type="button" id="interview-modal-save">保存</button>
        </div>
      </div>
    </div>
    <section class="todo-section">
      <h2>まずはここから</h2>
      <div class="todo-cards">
        <button id="open-candidate-panel" class="todo-card action-card" type="button">
          <h3>入社・退社タスク</h3>
          <p>入社準備、アカウント発行、備品手配などを求職者ごとに管理します。</p>
          <span class="card-cta">求職者リストを開く</span>
        </button>
        <div class="todo-card">
          <h3>依頼トラッカー</h3>
          <p>各チームからの依頼を集約し、担当/期限を明確にする機能を準備中。</p>
        </div>
        <div class="todo-card">
          <h3>リマインダー</h3>
          <p>面談や評価の期日を逃さないためのリマインダーを順次追加予定です。</p>
        </div>
      </div>
      <p class="todo-note">※ これはプレビュー画面です。機能は順次追加されます。</p>
    </section>
  </div>
  <div id="memo-container" class="hidden">
    <div class="memo-layout">
      <aside class="memo-sidebar">
        <div class="memo-sidebar-header">
          <div class="sidebar-title-group">
            <h2>Memos</h2>
            <button id="memo-back-startup-button" class="header-back-btn">スタートに戻る</button>
          </div>
          <div class="header-buttons">
            <button id="bulk-delete-memo-button" class="icon-button danger hidden" title="選択したメモを削除">🗑️</button>
            <button id="add-memo-button" class="icon-button" title="新規メモ">+</button>
          </div>
        </div>
        <div class="memo-folder-list-container">
          <div class="folder-list-header">
            <h3>Folders</h3>
            <button id="create-folder-button" class="icon-button small" title="フォルダ作成">+</button>
          </div>
          <ul id="memo-folder-list" class="memo-folder-list">
            <!-- Folders will be injected here -->
          </ul>
        </div>
        <div class="memo-search-container">
          <input type="text" id="memo-search-input" placeholder="メモを検索..." autocomplete="off">
        </div>
        <ul id="memo-list" class="memo-list">
          <!-- Memo items will be injected here -->
        </ul>

      </aside>
      <main class="memo-editor-area">
        <div id="memo-editor-placeholder" class="memo-placeholder">
          <p>メモを選択するか、新規作成してください</p>
        </div>
        <div id="memo-editor" class="memo-editor hidden">
          <div class="memo-editor-header">
            <div class="memo-header-top-row">
              <button id="memo-back-button" class="icon-button mobile-only" title="一覧に戻る">←</button>
              <div class="memo-folder-selector-wrapper">
                <select id="memo-folder-select" class="memo-folder-select">
                  <option value="">未分類</option>
                </select>
              </div>
              <span id="memo-last-updated" class="memo-meta"></span>
            </div>

            <div class="memo-title-wrapper">
              <input type="text" id="memo-title-input" placeholder="タイトルを入力..." class="memo-title-input">
              <button id="memo-title-save-button" class="primary small-button">保存</button>
            </div>

            <div class="memo-tags-wrapper">
              <div id="memo-tags-list" class="memo-tags-list"></div>
              <input type="text" id="memo-tag-input" class="memo-tag-input" placeholder="+ タグ (#で追加)">
            </div>

            <div class="editor-actions">
              <input type="file" id="memo-image-input" accept="image/*" class="hidden">
              <button id="insert-image-button" class="icon-button" title="画像を挿入">📷</button>
              <button id="insert-box-button" class="icon-button" title="枠を追加">🔲</button>
              <button id="delete-memo-button" class="danger icon-button" title="削除">🗑️</button>
            </div>
          </div>
          <div id="memo-toolbar" class="memo-toolbar">
            <button id="toolbar-bold" class="toolbar-btn" title="太字"><b>B</b></button>
            <div class="toolbar-separator"></div>
            <div class="color-picker-wrapper">
              <button id="toolbar-color" class="toolbar-btn" title="文字色">
                <span class="color-indicator">A</span>
              </button>
              <div id="toolbar-color-palette" class="color-palette hidden">
                <button class="color-dot" data-color="inherit" style="background:#555; border:1px solid #ddd;"
                  title="リセット"></button>
                <button class="color-dot" data-color="#e57373" style="background:#e57373;" title="赤"></button>
                <button class="color-dot" data-color="#f06292" style="background:#f06292;" title="ピンク"></button>
                <button class="color-dot" data-color="#ba68c8" style="background:#ba68c8;" title="紫"></button>
                <button class="color-dot" data-color="#64b5f6" style="background:#64b5f6;" title="青"></button>
                <button class="color-dot" data-color="#4dd0e1" style="background:#4dd0e1;" title="シアン"></button>
                <button class="color-dot" data-color="#81c784" style="background:#81c784;" title="緑"></button>
                <button class="color-dot" data-color="#ffd54f" style="background:#ffd54f;" title="黄"></button>
                <button class="color-dot" data-color="#ff8a65" style="background:#ff8a65;" title="オレンジ"></button>
                <button class="color-dot" data-color="#a1887f" style="background:#a1887f;" title="茶"></button>
              </div>
            </div>
            <div class="toolbar-separator"></div>
            <button id="toolbar-layer-front" class="toolbar-btn" title="最前面へ">⬆️</button>
            <button id="toolbar-layer-back" class="toolbar-btn" title="最背面へ">⬇️</button>
          </div>
          <div id="memo-content-editor" class="memo-content-editor" contenteditable="true" role="textbox"
            aria-multiline="true"></div>
        </div>
      </main>
    </div>
  </div>

  <!-- ===== Vault Container ===== -->
  <div id="vault-container" class="hidden">
    <div class="vault-header">
      <h1 class="vault-title">🔐 Vault</h1>
      <div class="vault-header-actions">
        <button id="vault-back-startup-button" class="secondary">スタートに戻る</button>
        <button id="vault-lock-button" class="secondary" title="ロックする">🔒</button>
        <button id="vault-add-button">+ 新規追加</button>
      </div>
    </div>
    <div class="vault-search-container">
      <input type="text" id="vault-search-input" placeholder="サービス名やIDで検索..." autocomplete="off">
      <select id="vault-sort-select">
        <option value="newest">新しい順</option>
        <option value="oldest">古い順</option>
        <option value="name-asc">名前順</option>
      </select>
      <select id="vault-filter-category">
        <option value="all">すべて</option>
        <!-- Options dynamically populated -->
      </select>
    </div>
    <ul id="vault-list" class="vault-list"></ul>

    <!-- Lock Screen Overlay -->
    <div id="vault-lock-screen" class="vault-lock-screen">
      <div class="vault-lock-content">
        <h2>🔐 Vault Locked</h2>
        <p>マスターパスワードを入力して解除</p>
        <input type="password" id="vault-master-password-input" placeholder="Master Password">
        <button id="vault-unlock-button" class="primary">解除</button>
      </div>
    </div>
  </div>

  <!-- Vault Modal -->
  <div id="vault-modal-backdrop" class="hidden">
    <div id="vault-modal">
      <h2 id="vault-modal-title">パスワードを追加</h2>
      <form id="vault-form" autocomplete="off">
        <div class="vault-form-row">
          <label for="vault-input-title">サービス名</label>
          <input type="text" id="vault-input-title" placeholder="例: Google" required>
        </div>
        <div class="vault-form-row">
          <label for="vault-input-category">カテゴリ</label>
          <input type="text" id="vault-input-category" list="vault-category-suggestions" placeholder="カテゴリを入力...">
          <datalist id="vault-category-suggestions"></datalist>
        </div>
        <div class="vault-form-row">
          <label for="vault-input-url">URL</label>
          <input type="text" id="vault-input-url" placeholder="https://...">
        </div>
        <div class="vault-form-row">
          <label for="vault-input-login-id">ログインID / メール</label>
          <input type="text" id="vault-input-login-id" placeholder="user@example.com">
        </div>
        <div class="vault-form-row">
          <label for="vault-input-password">パスワード</label>
          <div class="vault-password-wrapper">
            <input type="password" id="vault-input-password" placeholder="パスワード">
            <button type="button" id="vault-modal-toggle-pw" class="vault-toggle-btn" title="表示/非表示">👁️</button>
          </div>
        </div>
        <div class="vault-form-row">
          <label for="vault-input-memo">メモ</label>
          <textarea id="vault-input-memo" placeholder="備考..."></textarea>
        </div>
        <div class="vault-form-actions">
          <button type="button" id="vault-modal-cancel">キャンセル</button>
          <button type="submit">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== DataBase Container ===== -->
  <div id="database-container" class="hidden">
    <div class="database-header">
      <h1 class="database-title">👥 DataBase</h1>
      <div class="database-header-actions">
        <button id="database-back-startup-button" class="secondary">スタートに戻る</button>
        <button id="database-columns-button" class="secondary">表示項目</button>
        <button id="database-filter-button" class="secondary">フィルター</button>
        <button id="database-export-button" class="secondary">CSVエクスポート</button>
        <button id="database-import-button" class="secondary">CSVインポート</button>
        <input type="file" id="database-import-input" accept=".csv" class="hidden">
        <button id="database-add-button">+ 職員を追加</button>
      </div>
    </div>
    <div class="database-search-container">
      <input type="text" id="database-search-input" placeholder="氏名、部署、グレード、在籍状況などで検索..." autocomplete="off">
    </div>
    <div class="database-list-container">
      <div class="database-list-wrapper">
        <table class="database-table">
          <thead>
            <tr id="database-table-header-row">
              <!-- Dynamically populated headers -->
            </tr>
          </thead>
          <tbody id="database-list">
            <!-- Dynamically populated rows -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Filter Modal -->
  <div id="filter-modal-backdrop" class="hidden">
    <div id="filter-modal">
      <h2>フィルター設定</h2>
      <div id="filter-inputs-container"
        style="overflow-y: auto; max-height: 60vh; display: flex; flex-direction: column; gap: 10px;">
        <!-- Dynamically populated -->
      </div>
      <div class="form-actions">
        <button type="button" id="filter-modal-reset" class="secondary">リセット</button>
        <button type="button" id="filter-modal-cancel">キャンセル</button>
        <button type="button" id="filter-modal-apply">適用</button>
      </div>
    </div>
  </div>

  <!-- Column Selection Modal -->
  <div id="column-modal-backdrop" class="hidden">
    <div id="column-modal">
      <h2 id="column-modal-title">表示項目の選択</h2>
      <div id="column-checkboxes">
        <!-- Dynamically populated checkboxes -->
      </div>
      <div class="form-actions">
        <button type="button" id="column-modal-cancel">キャンセル</button>
        <button type="button" id="column-modal-save">保存</button>
      </div>
    </div>
  </div>

  <!-- Employee Modal -->
  <div id="employee-modal-backdrop" class="hidden">
    <div id="employee-modal">
      <h2 id="employee-modal-title">職員を追加</h2>
      <form id="employee-form" autocomplete="off">
        <div class="form-row two-col">
          <div>
            <label for="emp-input-name">氏名 <span class="required">*</span></label>
            <input type="text" id="emp-input-name" placeholder="山田 太郎" required>
          </div>
          <div>
            <label for="emp-input-id">社員番号 <span class="required">*</span></label>
            <input type="text" id="emp-input-id" placeholder="1001" required>
          </div>
        </div>
        <div class="form-row two-col">
          <div>
            <label for="emp-input-dept">部門</label>
            <input type="text" id="emp-input-dept" placeholder="開発部">
          </div>
          <div>
            <label for="emp-input-department">部署</label>
            <input type="text" id="emp-input-department" placeholder="フロントエンドチーム">
          </div>
        </div>
        <div class="form-row two-col">
          <div>
            <label for="emp-input-title">役職</label>
            <input type="text" id="emp-input-title" placeholder="マネージャー">
          </div>
          <div>
            <label for="emp-input-grade">グレード</label>
            <input type="text" id="emp-input-grade" placeholder="E3">
          </div>
        </div>
        <div class="form-row two-col">
          <div>
            <label for="emp-input-birthday">誕生日</label>
            <input type="date" id="emp-input-birthday">
          </div>
          <div>
            <label>年齢</label>
            <input type="text" id="emp-input-age" class="readonly-field" readonly placeholder="自動計算">
          </div>
        </div>
        <div class="form-row two-col">
          <div>
            <label for="emp-input-hire-date">入社日</label>
            <input type="date" id="emp-input-hire-date">
          </div>
          <div>
            <label>在籍期間</label>
            <input type="text" id="emp-input-tenure" class="readonly-field" readonly placeholder="自動計算">
          </div>
        </div>
        <div class="form-row two-col">
          <div>
            <label for="emp-input-contract-type">契約形態</label>
            <select id="emp-input-contract-type">
              <option value="無期">無期</option>
              <option value="有期">有期</option>
              <option value="出向">出向</option>
            </select>
          </div>
          <div>
            <label for="emp-input-contract-end">契約満了日</label>
            <input type="date" id="emp-input-contract-end">
          </div>
        </div>
        <div class="form-row two-col">
          <div>
            <label for="emp-input-business-unit">事業部</label>
            <select id="emp-input-business-unit">
              <option value="">選択してください</option>
              <option value="管理">管理</option>
              <option value="営業">営業</option>
              <option value="その他">その他</option>
            </select>
          </div>
          <div>
            <label for="emp-input-resignation-date">退職日</label>
            <input type="date" id="emp-input-resignation-date">
          </div>
        </div>
        <div class="form-row">
          <label for="emp-input-status">在籍状況</label>
          <select id="emp-input-status">
            <option value="在籍">在籍</option>
            <option value="休職">休職</option>
            <option value="退職">退職</option>
          </select>
        </div>
        <div class="form-row">
          <label for="emp-input-email">メールアドレス</label>
          <input type="email" id="emp-input-email" placeholder="taro.yamada@example.com">
        </div>
        <div class="form-row">
          <label for="emp-input-phone">電話番号</label>
          <input type="tel" id="emp-input-phone" placeholder="090-1234-5678">
        </div>
        <div class="form-row">
          <label for="emp-input-note">メモ</label>
          <textarea id="emp-input-note" placeholder="備考..."></textarea>
        </div>
        <div class="form-actions">
          <button type="button" id="employee-modal-cancel">キャンセル</button>
          <button type="submit">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Image Editor Modal -->
  <div id="image-editor-modal-backdrop" class="hidden">
    <div id="image-editor-modal">
      <h2>画像を編集</h2>
      <div class="image-editor-container">
        <img id="image-editor-preview" src="" alt="Preview">
      </div>
      <div class="image-editor-controls">
        <label>W: <input type="number" id="image-editor-width" min="1"></label>
        <span>x</span>
        <label>H: <input type="number" id="image-editor-height" min="1"></label>
      </div>
      <div class="image-editor-actions">
        <button id="image-editor-cancel" class="secondary">キャンセル</button>
        <button id="image-editor-save" class="primary">アップロード</button>
      </div>
    </div>
  </div>

  <div id="todo-settings-modal-backdrop" class="hidden">
    <div id="todo-settings-modal" class="settings-modal">
      <h2>設定</h2>
      <div class="settings-section">
        <h3>更新情報</h3>
        <ul id="todo-updates-list" class="updates-list"></ul>
      </div>
      <div class="settings-section">
        <h3>FAQ</h3>

        <p class="settings-help">Team Todoについてよくある質問です。</p>
        <ul class="faq-list">
          <li>「入社・退社タスク」で求職者ごとの進捗を管理できます。</li>
          <li>データはブラウザ内に保存され、サーバーには送信されません（プライバシー重視）。</li>
          <li>ブラウザの履歴削除などでデータが消える場合がありますのでご注意ください。</li>
        </ul>
        <a href="/faq-todo.html">FAQを見る</a>
      </div>
      <button id="close-todo-settings-modal-button" type="button">閉じる</button>
    </div>
  </div>

  <div id="archive-container" style="display: none;">
    <div class="archive-toolbar">
      <button id="back-to-main-button-top">メイン画面へ戻る</button>
      <div class="archive-bulk-actions">
        <label class="archive-select-all">
          <input type="checkbox" id="archive-select-all-checkbox">
          全て選択
        </label>
        <button id="archive-delete-selected-button" type="button" disabled>選択したタスクを削除</button>
      </div>
    </div>
    <h1>アーカイブ</h1>
    <ul id="archive-tasks"></ul>
    <button id="back-to-main-button">メイン画面へ戻る</button>
  </div>

  <div id="label-modal-backdrop" class="hidden">
    <div id="label-modal">
      <h2>カテゴリーラベルを管理</h2>
      <ul id="labels-list"></ul>
      <form id="add-label-form">
        <input type="text" id="label-name-input" placeholder="ラベル名 (12文字以内)" maxlength="12" required />
        <div class="label-color-selector">
          <div id="label-color-palette"></div>
          <button type="submit">新しいラベルを追加</button>
        </div>
      </form>
      <button id="close-label-modal-button">閉じる</button>
    </div>
  </div>

  <div id="task-detail-modal-backdrop" class="hidden">
    <div id="task-detail-modal">
      <div class="view-mode">
        <h2 id="modal-task-title"></h2>
        <p id="modal-task-memo"></p>
      </div>
      <div class="edit-mode hidden">
        <input type="text" id="modal-edit-title-input" placeholder="タスクのタイトル">
        <textarea id="modal-edit-memo-input" placeholder="内容やメモ"></textarea>
        <input type="date" id="modal-edit-due-date-input" placeholder="期日">
      </div>
      <div class="modal-buttons">
        <button id="edit-task-button" class="view-mode">編集</button>
        <button id="save-task-button" class="edit-mode hidden">保存</button>
        <button id="cancel-edit-button" class="edit-mode hidden">キャンセル</button>
        <button id="close-task-detail-modal-button">閉じる</button>
      </div>
    </div>
  </div>

  <div id="settings-modal-backdrop" class="hidden">
    <div id="settings-modal">
      <h2>設定</h2>
      <div id="updates-restart-hint" class="updates-restart-hint hidden">最新の更新が見つかりました。反映のためにアプリの再読み込みをおすすめします。</div>

      <div class="settings-section">
        <h3>アカウント</h3>
        <div class="settings-item">
          <span>ユーザーID</span>
          <span id="settings-user-id"></span>
        </div>
        <div class="settings-item">
          <a href="/faq.html">FAQを見る</a>
        </div>
      </div>

      <div class="settings-section">
        <h3>更新情報</h3>
        <div id="updates-window" class="updates-window" title="クリックして拡大表示">
          <ul id="updates-list-compact" class="updates-list"></ul>
          <div class="updates-footer">最新3件を表示中 — クリックで全件</div>
        </div>
      </div>

      <div class="settings-section">
        <h3>スタートアップ画面</h3>
        <p class="settings-help" style="margin: 0 0 8px; color: var(--text-secondary);">
          起動時のモード選択画面に戻ります。ログイン状態は維持されます。
        </p>
        <button id="return-startup-button" type="button">スタートアップへ戻る</button>
      </div>

      <div class="settings-section">
        <h3>お問い合わせ</h3>
        <p class="settings-help" style="margin: 0 0 8px; color: var(--text-secondary);">
          製作者への連絡先はこちらです。ご要望・バグ報告などお気軽にどうぞ。
        </p>
        <div class="contact-box"
          style="display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px; border:1px solid var(--border-color); border-left:3px solid var(--primary-color); border-radius:4px; background-color: var(--bg-color);">
          <code style="font-size: 0.95em;">happy.hacking.frog@gmail.com</code>
          <a href="mailto:happy.hacking.frog@gmail.com" style="text-decoration:none;">メールを作成</a>
        </div>
      </div>

      <div class="settings-section">
        <h3>壁紙設定</h3>
        <div id="wallpaper-choices">
          <div class="wallpaper-choice" data-theme="custom" title="カスタム壁紙">
            <div class="wallpaper-thumbnail custom" id="custom-wallpaper-thumb"></div>
            <button id="choose-custom-wallpaper-button" type="button">画像を選択</button>
            <input type="file" id="custom-wallpaper-input" accept="image/*" class="hidden" />
            <span>カスタム</span>
          </div>
          <div class="wallpaper-choice" data-theme="pastel" title="パステルビーチ">
            <div class="wallpaper-thumbnail pastel"></div>
            <span>パステル</span>
          </div>
          <div class="wallpaper-choice" data-theme="okinawa" title="沖縄ビーチ">
            <div class="wallpaper-thumbnail okinawa"></div>
            <span>沖縄</span>
          </div>
          <div class="wallpaper-choice" data-theme="sunny" title="サニービーチ">
            <div class="wallpaper-thumbnail sunny"></div>
            <span>サニー</span>
          </div>
          <div class="wallpaper-choice" data-theme="skycastle" title="天空の城">
            <div class="wallpaper-thumbnail skycastle"></div>
            <span>天空の城</span>
          </div>
          <div class="wallpaper-choice" data-theme="jungle" title="神秘の森">
            <div class="wallpaper-thumbnail jungle"></div>
            <span>神秘の森</span>
          </div>
          <div class="wallpaper-choice" data-theme="dolphins" title="イルカの海">
            <div class="wallpaper-thumbnail dolphins"></div>
            <span>イルカの海</span>
          </div>
          <div class="wallpaper-choice" data-theme="lunar" title="月の満ち欠け">
            <div class="wallpaper-thumbnail lunar"></div>
            <span>ルナー</span>
          </div>
          <div class="wallpaper-choice" data-theme="happyhacking" title="Happy Hacking">
            <div class="wallpaper-thumbnail happyhacking"></div>
            <span>Happy Hacking</span>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <h3>スリープ設定</h3>
        <div class="settings-item">
          <span>スリープモード</span>
          <label>
            <input type="checkbox" id="sleep-toggle"> 有効にする
          </label>
        </div>
        <div class="settings-item">
          <span>スリープまでの時間（秒）</span>
          <input type="number" id="sleep-seconds" min="1" max="180" step="1" value="60" style="width:90px;">
        </div>
      </div>

      <div class="settings-section">
        <button id="logout-button-modal" class="danger">ログアウト</button>
      </div>

      <button id="close-settings-modal-button">閉じる</button>
    </div>
  </div>

  <div id="recurring-task-modal-backdrop" class="hidden">
    <div id="recurring-task-modal">
      <h2>繰り返しタスクを追加</h2>
      <form id="recurring-task-form">
        <input type="text" id="recurring-task-input" placeholder="タスクのタイトルを入力..." required>
        <textarea id="recurring-task-memo" placeholder="内容やメモ...（任意）"></textarea>
        <label class="form-label" for="recurring-task-label">ラベル</label>
        <select id="recurring-task-label">
          <option value="">ラベルなし</option>
        </select>
        <label class="form-label" for="recurring-type">種類</label>
        <select id="recurring-type" required>
          <option value="" disabled selected>選択してください</option>
          <option value="weekly">毎週</option>
          <option value="monthly">毎月</option>
          <option value="yearly">毎年</option>
        </select>

        <div id="weekly-options" class="recurring-options hidden">
          <span class="form-label">曜日</span>
          <div class="weekly-checkboxes">
            <label><input type="checkbox" value="0">日</label>
            <label><input type="checkbox" value="1">月</label>
            <label><input type="checkbox" value="2">火</label>
            <label><input type="checkbox" value="3">水</label>
            <label><input type="checkbox" value="4">木</label>
            <label><input type="checkbox" value="5">金</label>
            <label><input type="checkbox" value="6">土</label>
          </div>
        </div>

        <div id="monthly-options" class="recurring-options hidden">
          <label class="form-label" for="monthly-type">方式</label>
          <select id="monthly-type">
            <option value="date">日にちで指定</option>
            <option value="week">週×曜日で指定</option>
          </select>

          <div id="monthly-date-selector" class="monthly-selector">
            <label class="form-label" for="monthly-date">日にち</label>
            <select id="monthly-date"></select>
          </div>

          <div id="monthly-week-selector" class="monthly-selector hidden">
            <label class="form-label" for="monthly-week">週</label>
            <select id="monthly-week">
              <option value="1">第1</option>
              <option value="2">第2</option>
              <option value="3">第3</option>
              <option value="4">第4</option>
              <option value="-1">最終</option>
            </select>
            <label class="form-label" for="monthly-weekday">曜日</label>
            <select id="monthly-weekday">
              <option value="0">日曜日</option>
              <option value="1">月曜日</option>
              <option value="2">火曜日</option>
              <option value="3">水曜日</option>
              <option value="4">木曜日</option>
              <option value="5">金曜日</option>
              <option value="6">土曜日</option>
            </select>
          </div>
        </div>

        <div id="yearly-options" class="recurring-options hidden">
          <label class="form-label" for="yearly-month">月</label>
          <select id="yearly-month"></select>
          <label class="form-label" for="yearly-date">日</label>
          <select id="yearly-date"></select>
        </div>

        <div class="recurring-form-actions">
          <button type="submit">保存</button>
          <button type="button" id="close-recurring-modal-button">閉じる</button>
        </div>
      </form>
    </div>
  </div>

  <div id="recurring-list-modal-backdrop" class="hidden">
    <div id="recurring-list-modal">
      <h2>登録済みの繰り返しタスク</h2>
      <ul id="recurring-list-modal-items"></ul>
      <button id="close-recurring-list-modal-button">閉じる</button>
    </div>
  </div>

  <!-- 追加: 新規タスク作成モーダル -->
  <div id="add-task-modal-backdrop" class="hidden">
    <div id="add-task-modal">
      <h2>新しいタスクを追加</h2>
      <div class="add-task-form">
        <input type="text" id="new-task-title-input" placeholder="タスクのタイトルを入力...">
        <textarea id="new-task-memo-input" placeholder="内容やメモ...（任意）"></textarea>
        <div class="date-inputs" id="due-date-fields">
          <input type="text" id="due-year" inputmode="numeric" pattern="\\d*" maxlength="4" placeholder="YYYY"
            aria-label="年">
          <span class="date-sep">/</span>
          <input type="text" id="due-month" inputmode="numeric" pattern="\\d*" maxlength="2" placeholder="MM"
            aria-label="月">
          <span class="date-sep">/</span>
          <input type="text" id="due-day" inputmode="numeric" pattern="\\d*" maxlength="2" placeholder="DD"
            aria-label="日">
          <input type="date" id="due-date-input" class="hidden">
        </div>
        <button id="add-task-button">ストックに追加</button>
      </div>
      <div id="color-picker"></div>
      <div id="selected-label-hint" class="label-hint"></div>
      <button id="close-add-task-modal-button">閉じる</button>
    </div>
  </div>

  <!-- 更新情報モーダル -->
  <div id="updates-modal-backdrop" class="hidden">
    <div id="updates-modal">
      <h2>更新情報</h2>
      <ul id="updates-list-full" class="updates-list"></ul>
      <button id="close-updates-modal-button">閉じる</button>
    </div>
  </div>

  <script type="module" src="./main.js?v=memo_v1"></script>

</body>

</html>